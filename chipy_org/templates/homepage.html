{% extends "site_base.html" %}

{% load i18n staticfiles flatblock_tags %}

{% block head_title %}{% trans "Welcome" %}{% endblock %}

{% block body_class %}home{% endblock %}

{% block body %}
    <header id="home-header" class="row-fluid">
        <div class="span6">
            <div id="home-content">
              <h1>Welcome to ChiPy</h1>
              <p>{% flatblock "homepage_welcome_text" %}</p>
              <a class="btn" href="#">Learn more &raquo;</a>
            </div>
        </div>
        <div class="span6">
            <img src="{{ STATIC_URL }}img/chipmunk.png" alt="ChiPy">
        </div>
    </header>

    <div class="row-fluid">
        <div class="module span4">
            <h2>In the Loop</h2>
            <p>Meetings happen in the downtown area the second Thursday of every month.</p>

            <h3>Next Meeting</h3>
            <p><strong>When:</strong> {{ next_meeting.when|default:'N/A'}}</p>

            {% if next_meeting %}
            <p><strong>Where:</strong> <a id="where-link" href="#">{{ next_meeting.where|default:'N/A'}}</a></p>
              <div id="where-dialog" title="Venue" style="display:none">
                {{ next_meeting.where.name }}<br>
                {{ next_meeting.where.address }}<br>              
                {% if next_meeting.where.directions %}
                  {{ next_meeting.where.directions }}<br>
                {% endif %}
                {% if next_meeting.where.phone %}
                  {{ next_meeting.where.phone }}<br>
                {% endif %}
                {% if next_meeting.where.email %}
                  {{ next_meeting.where.email }}<br>
                {% endif %}
              </div>              
            {% else %}              
            <p><strong>Where:</strong>{{ next_meeting.where|default:'N/A'}}</p>
            {% endif %}            
            {% if next_meeting %}
            <p><strong>RSVP:</strong> 
              {% if rsvp %}
                You have RSVPed <strong>{{ rsvp.get_response_display }}</strong><br>
                <strong>Change your RSVP: </strong>                
              {% endif %} 
              <a class="btn btn-mini" id="rsvp-yes">Yes</a> <a class="btn btn-mini" id="rsvp-maybe">Maybe</a> <a class="btn btn-mini" id="rsvp-no">No</a></p>
            <p>{{ next_meeting.number_rsvps }} going so far</p>
            {% else %}
              {% if request.user.is_staff %}
                <p>                
                  <a class="btn btn-primary" href="{% url admin:meetings_meeting_add %}">Create Meeting</a>
                </p>
              {% endif %}              
            {% endif %}
            <p><a class="btn" href="{% url past_meetings %}">Past meetings &raquo;</a></p>
        </div><!--/span-->
        <div class="module span4">
            <h2>This Month's Topics</h2>
            <ul>
              {% for topic in next_meeting.topics %}
                <li>
                  <strong>{{ topic.title }}</strong><br />
                  {% if topic.length %}
                    ({{ topic.minutes }} Minutes)<br />
                  {% endif %}
                  By: {{ topic.presentor }}<br />
                  {{ topic.description }}
                </li>
              {% endfor %}
            </ul>
        </div><!--/span-->
        <div class="module span4">
            <h2>IRC</h2>
            <p>Some of us like to hang out in the IRC #chipy channel on irc.freenode.net</p>
            <p><a class="btn" href="irc://irc.freenode.net/chipy">Start chatting &raquo;</a></p>
            <h2>Mailing List</h2>
            <p>Sign up to join the discussion.</p>
            <p><a class="btn" href="http://mail.python.org/mailman/listinfo/chicago">Sign up &raquo;</a></p>
        </div><!--/span-->
    </div><!-- #row-fluid -->
    <hr>
{% endblock %}

{% block extra_jquery %}
  $('#where-link').click(function() {
    $('#where-dialog').dialog({ width: 182, modal: true });
    return false;
  });

  $('#rsvp-yes').click(function(){
      $.ajax({
          type: 'POST',
          url: '{% url rsvp %}',
          data: {response:'Y', csrfmiddlewaretoken: '{{ csrf_token }}', meeting: '{{ next_meeting.id }}'},
          success: function(data){
              location.reload();
          },
      });
  });  
  $('#rsvp-maybe').click(function(){
      $.ajax({
          type: 'POST',
          url: '{% url rsvp %}',
          data: {response:'M', csrfmiddlewaretoken: '{{ csrf_token }}', meeting: '{{ next_meeting.id }}'},
          success: function(data){
              location.reload();
          },
      });  
  });  
  $('#rsvp-no').click(function(){
      $.ajax({
          type: 'POST',
          url: '{% url rsvp %}',
          data: {response:'N', csrfmiddlewaretoken: '{{ csrf_token }}', meeting: '{{ next_meeting.id }}'},
          success: function(data){
              location.reload();
          },
      });  
  });  
{% endblock %}
